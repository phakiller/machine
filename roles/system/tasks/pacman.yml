- name: Update pacman database
  become: yes
  pacman: update_cache=yes

- name: Install pacman tools
  become: yes
  pacman:
    name:
      - reflector
      - pacman-contrib

- name: Check pacman mirrors
  become: yes
  shell: cat /etc/pacman.d/mirrorlist
  register: reflector
  changed_when: False

- name: Optimize pacman mirrors
  become: yes
  shell: reflector --protocol https --sort rate --save /etc/pacman.d/mirrorlist
  when: reflector.stdout.find('Arch Linux mirrorlist generated by Reflector') == -1
  